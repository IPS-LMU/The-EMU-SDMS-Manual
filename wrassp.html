<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>wrassp.utf8</title>
  <meta name="description" content="">
  <meta name="generator" content="bookdown <!--bookdown:version--> and GitBook 2.6.7">

  <meta property="og:title" content="wrassp.utf8" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="wrassp.utf8" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#chap:wrassp"><span class="toc-section-number">1</span> The R package <code>wrassp</code> </a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="chap:wrassp" class="section level1">
<h1><span class="header-section-number">1</span> The R package <code>wrassp</code> <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></h1>
<p><img src="pics/EMU-webAppEmu_wrassp.png" width="75%" style="display: block; margin: auto;" /></p>
<!-- \section{Introduction} -->
<!-- This chapter gives an overview and introduction to the \texttt{wrassp} package. The \texttt{wrassp} package is a \texttt{w}rapper for \texttt{R} around Michel Scheffers' \href{http://libassp.sourceforge.net/}{\texttt{libassp}} (\texttt{A}dvanced \texttt{S}peech \texttt{S}ignal \texttt{P}rocessor). The \texttt{libassp} library and therefore the \texttt{wrassp} package provide functionality for handling speech signal files in most common audio formats and for performing signal analyses common in the phonetic and speech sciences. As such, \texttt{wrassp} fills a gap in the R package landscape as, to our knowledge, no previous packages provided this specialized functionality. The currently available signal processing functions provided by \texttt{wrassp} are: -->
<!-- \begin{itemize} -->
<!--   \item \texttt{acfana()}: Analysis of short-term autocorrelation function -->
<!--   \item \texttt{afdiff()}: Computes the first difference of the signal -->
<!--   \item \texttt{affilter()}: Filters the audio signal (e.g., low-pass and high-pass) -->
<!--   \item \texttt{cepstrum()}: Short-term cepstral analysis -->
<!--   \item \texttt{cssSpectrum()}: Cepstral smoothed version of \texttt{dftSpectrum()} -->
<!--   \item \texttt{dftSpectrum()}: Short-term DFT spectral analysis -->
<!--   \item \texttt{forest()}: Formant estimation -->
<!--   \item \texttt{ksvF0()}: F0 analysis of the signal -->
<!--   \item \texttt{lpsSpectrum()}: Linear predictive smoothed version of \texttt{dftSpectrum()} -->
<!--   \item \texttt{mhsF0()}: Pitch analysis of the speech signal using Michel Scheffers' \texttt{M}odified \texttt{H}armonic \texttt{S}ieve algorithm -->
<!--   \item \texttt{rfcana()}: Linear prediction analysis -->
<!--   \item \texttt{rmsana()}: Analysis of short-term Root Mean Square amplitude -->
<!--   \item \texttt{zcrana}(): Analysis of the averages of the short-term positive and negative zero-crossing rates -->
<!-- \end{itemize} -->
<!-- \noindent -->
<!-- The available file handling functions are: -->
<!-- \begin{itemize} -->
<!--   \item \texttt{read.AsspDataObj()}: read a \ac{ssff} or audio file into an \texttt{AsspDataObj}, which is the in-memory equivalent of the \ac{ssff} or audio file. -->
<!--   \item \texttt{write.AsspDataObj()}: write an \texttt{AsspDataObj} to file (usually \ac{ssff} or audio file formats). -->
<!-- \end{itemize} -->
<!-- See R's \texttt{help()} function for a comprehensive list of every function and object provided by the \texttt{wrassp} package is required (see R Example \ref{rexample:wrassp_help}). -->
<!-- <<rexample:wrassp_help, rexample=TRUE, eval=FALSE>>= -->
<!-- help(package="wrassp") -->
<!-- @ -->
<!-- As the \texttt{wrassp} package can be used independently of the \ac{emu-sdms} this chapter largely focuses on using it as an independent component. However, Section \ref{sec:wrassp_emu-sdms} provides an overview of how the package is integrated into the \ac{emu-sdms}. Further, although the \texttt{wrassp} package has its own set of example audio files (which can be accessed in the directory provided by \texttt{system.file(`extdata', package=`wrassp')}), this chapter will use the audio and \ac{ssff} files that are part of the \textit{ae} \texttt{emuDB} of the demo data provided by the \texttt{emuR} package. This is done primarily to provide an overview of what it is like using \texttt{wrassp} to work on files in an \texttt{emuDB}. R Example \ref{rexample:wrassp_loadDemoData} shows how to generate this demo data followed by a listing of the files contained in a directory of a single bundle called \textit{msajc003} (see Chapter \ref{chap:emuDB} for information about the \texttt{emuDB} format). The output of the call to \texttt{list.files()} shows four files where the \texttt{.dft} and \texttt{.fms} files are in the \ac{ssff} file format (see Appendix \ref{subsec:app_chapFileFormatsSSFF} for further details). The \texttt{\_annot.json} file contains the annotation information, and the \texttt{.wav} file is one of the audio files that will be used in various signal processing examples in this chapter. -->
<!-- <<rexample:wrassp_loadDemoData, rexample=TRUE, message=FALSE>>= -->
<!-- # load the emuR package -->
<!-- library(emuR) -->
<!-- # create demo data in directory  -->
<!-- # provided by tempdir() -->
<!-- create_emuRdemoData(dir = tempdir()) -->
<!-- # create path to demo database -->
<!-- path2ae = file.path(tempdir(), "emuR_demoData", "ae_emuDB") -->
<!-- # create path to bundle in database -->
<!-- path2bndl = file.path(path2ae, "0000_ses", "msajc003_bndl") -->
<!-- # list files in bundle directory -->
<!-- list.files(path2bndl) -->
<!-- @ -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \section{File I/0 and the \texttt{AsspDataObj}} -->
<!-- One of the aims of \texttt{wrassp} is to provide mechanisms for handling speech-related files such as audio files and derived and complementary signal files. To have an in-memory object that can hold these file types in a uniform way the \texttt{wrassp} package provides the \texttt{AsspDataObj} data type. R Example \ref{rexample:wrassp_read} shows how the \texttt{read.AsspDataObj()} can be used to import a \texttt{.wav} audio file. -->
<!-- <<rexample:wrassp_read, rexample=TRUE, tidy=TRUE>>= -->
<!-- # load the wrassp package -->
<!-- library(wrassp) -->
<!-- # create path to wav file -->
<!-- path2wav = file.path(path2bndl, "msajc003.wav") -->
<!-- # read audio file -->
<!-- au = read.AsspDataObj(path2wav) -->
<!-- # show class -->
<!-- class(au) -->
<!-- # show print() output of object -->
<!-- print(au) -->
<!-- @ -->
<!-- As can be seen in R Example \ref{rexample:wrassp_read}, the resulting \texttt{au} object is of the class \texttt{AsspDataObj}. The output of \texttt{print} provides additional information about the object, such as its sampling rate, duration, data type and data structure information. Since the file we loaded is audio only, the object contains exactly one track. Further, since it is a mono file, this track only has a single field. We will later encounter different types of data with more than one track and multiple fields per track. R Example \ref{rexample:wrassp_extrAttrs} shows function calls that extract the various attributes from the object (e.g., duration, sampling rate and the number of records). -->
<!-- <<rexample:wrassp_extrAttrs, rexample=TRUE>>= -->
<!-- # show duration -->
<!-- dur.AsspDataObj(au) -->
<!-- # show sampling rate -->
<!-- rate.AsspDataObj(au) -->
<!-- # show number of records/samples -->
<!-- numRecs.AsspDataObj(au) -->
<!-- # shorten filePath attribute  -->
<!-- # to 10 chars only to prettify output -->
<!-- attr(au, "filePath")  = paste0(substr(attr(au, "filePath"),  -->
<!--                                       start = 1, -->
<!--                                       stop = 45), "...") -->
<!-- # show additional attributes -->
<!-- attributes(au) -->
<!-- @ -->
<!-- The sample values belonging to a trackdata objects tracks are also stored within an \texttt{AsspDataObj} object. As mentioned above, the currently loaded object contains a single mono audio track. Accessing the data belonging to this track, in the form of a matrix, can be achieved using the track's name in combination with the \texttt{\$} notation known from R's common named \texttt{list} object. Each matrix has the same number of rows as the track has records and as many columns as the track has fields. R Example \ref{rexample:wrassp_extrData} shows how the \texttt{audio} track can be accessed. -->
<!-- <<rexample:wrassp_extrData, rexample=TRUE>>= -->
<!-- # show track names -->
<!-- tracks.AsspDataObj(au) -->
<!-- # or an alternative way to show track names -->
<!-- names(au) -->
<!-- # show dimensions of audio attribute -->
<!-- dim(au$audio) -->
<!-- # show first sample value of audio attribute -->
<!-- head(au$audio, n = 1) -->
<!-- @ -->
<!-- This data can, for example, be used to generate an oscillogram of the audio file as shown in R Example \ref{rexample:wrassp_plotOsci}, which produces Figure \ref{fig:wrassp_plotOsci}. -->
<!-- <<rexample:wrassp_plotOsci, rexample=TRUE, eval=FALSE>>= -->
<!-- # calculate sample time of every 10th sample -->
<!-- samplesIdx = seq(0, numRecs.AsspDataObj(au) - 1, 10) -->
<!-- samplesTime = samplesIdx / rate.AsspDataObj(au) -->
<!-- # extract every 10th sample using window() function -->
<!-- samples = window(au$audio, deltat=10) -->
<!-- # plot samples stored in audio attribute -->
<!-- # (only plot every 10th sample to accelerate plotting) -->
<!-- plot(samplesTime, -->
<!--      samples, -->
<!--      type = "l", -->
<!--      xlab = "time (s)", -->
<!--      ylab = "Audio samples (INT16)") -->
<!-- @ -->
<!-- <<wrassp_plotOsci, fig.cap = "Oscillogram generated from samples stored in the \\texttt{audio} track of the object \\texttt{au}.", fig.width=6, fig.height=3, echo=FALSE>>= -->
<!-- # calculate sample time of every 10th sample -->
<!-- samplesIdx = seq(0, numRecs.AsspDataObj(au) - 1, 10) -->
<!-- samplesTime = samplesIdx / rate.AsspDataObj(au) -->
<!-- # extract every 10th sample using window() function -->
<!-- samples = window(au$audio, deltat=10) -->
<!-- # plot samples stored in audio attribute -->
<!-- # (only plot every 10th sample to accelerate plotting) -->
<!-- plot(samplesTime, -->
<!--      samples, -->
<!--      type = "l", -->
<!--      xlab = "time (s)", -->
<!--      ylab = "Audio samples (INT16)") -->
<!-- @ -->
<!-- The export counterpart to \texttt{read.AsspDataObj()} function is \\\texttt{write.AsspDataObj()}. It is used to store in-memory \texttt{AsspDataObj} objects to disk and is particularly useful for converting other formats to or storing data in the \ac{ssff} file format as described in Section \ref{sec:wrassp_genSSFF}. To show how this function can be used to write a slightly altered version of the \texttt{au} object to a file, R Example \ref{rexample:wrassp_writeAudio} initially multiplies all the sample values of \texttt{au\$audio} by a factor of \texttt{0.5}. The resulting \texttt{AsspDataObj} is then written to an audio file in a temporary directory provided by \texttt{R}'s \texttt{tempdir()} function. -->
<!-- <<rexample:wrassp_writeAudio, rexample=TRUE, results='hide'>>= -->
<!-- # manipulate the audio samples -->
<!-- au$audio = au$audio * 0.5 -->
<!-- # write to file in directory  -->
<!-- # provided by tempdir() -->
<!-- write.AsspDataObj(au, file.path(tempdir(), 'newau.wav')) -->
<!-- @ -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \section{Signal processing} -->
<!-- As mentioned in the introduction to this chapter, the \texttt{wrassp} package is capable of more than just the mere importing and exporting of specific signal file formats. This section will focus on demonstrating three of \texttt{wrassp}'s signal processing functions that calculate formant values, their corresponding bandwidths, the fundamental frequency contour and the RMS energy contour. Section \ref{subsec:wrassp_formants} and \ref{subsec:wrassp_f0} demonstrates signal processing to the audio file saved under \texttt{path2wav}, while Section \ref{subsec:wrassp_RMS} adresses processing all the audio files belonging to the \textit{ae} \texttt{emuDB}. -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \subsection{The \texttt{wrasspOutputInfos} object} -->
<!-- \label{subsec:wrassp_wrasspOutputInfos} -->
<!-- The \texttt{wrassp} package comes with the \texttt{wrasspOutputInfos} object, which provides information about the various signal processing functions provided by the package. The \texttt{wrasspOutputInfos} object stores meta information associated with the different signal processing functions \texttt{wrassp} provides. R Example \ref{rexample:wrassp_outputInfosName} shows the names of the \texttt{wrasspOutputInfos} object which correspond to the function names listed in the introduction of this chapter. -->
<!-- <<rexample:wrassp_outputInfosName, rexample=TRUE>>= -->
<!-- # show all function names -->
<!-- names(wrasspOutputInfos) -->
<!-- @ -->
<!-- This object can be useful to get additional information about a specific \texttt{wrassp} function. It contains information about the default file extension (\texttt{\$ext}), the tracks produced (\texttt{\$tracks}) and the output file type (\texttt{\$outputType}). R Example \ref{rexample:wrassp_outputInfosForest} shows this information for the \texttt{forest()} function.  -->
<!-- <<rexample:wrassp_outputInfosForest, rexample=TRUE>>= -->
<!-- # show output info of forest function -->
<!-- wrasspOutputInfos$forest -->
<!-- @ -->
<!-- The examples that follow will make use of this \texttt{wrasspOutputInfos} object mainly to acquire the default file extensions given by a specific \texttt{wrassp} signal processing function. -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \subsection{Formants and their bandwidths} -->
<!-- \label{subsec:wrassp_formants} -->
<!-- The already mentioned \texttt{forest()} is \texttt{wrassp}'s formant estimation function. The default behavior of this formant tracker is to calculate the first four formants and their bandwidths. R Example \ref{rexample:wrassp_calcFms} shows the usage of this function. As the default behavior of every signal processing function provided by \texttt{wrassp} is to store its result to a file, the \texttt{toFile} parameter of \texttt{forest()} is set to \texttt{FALSE} to prevent this behavior. This results in the same \texttt{AsspDataObj} object as when exporting the result to file and then importing the file into R using \texttt{read.AsspDataObj()}, but circumvents the disk reading/writing overhead. -->
<!-- <<rexample:wrassp_calcFms, rexample=TRUE>>= -->
<!-- # calculate formants and corresponding bandwidth values -->
<!-- fmBwVals = forest(path2wav, toFile=F) -->
<!-- # show class vector -->
<!-- class(fmBwVals) -->
<!-- # show track names -->
<!-- tracks.AsspDataObj(fmBwVals) -->
<!-- # show dimensions of "fm" track -->
<!-- dim(fmBwVals$fm) -->
<!-- # check dimensions of tracks are the same -->
<!-- all(dim(fmBwVals$fm) == dim(fmBwVals$bw)) -->
<!-- @ -->
<!-- As can be seen in R Example \ref{rexample:wrassp_calcFms}, the object resulting from the \texttt{forest()} function is an object of class \texttt{AsspDataObj} with the tracks \texttt{"fm"} (formants) and \texttt{"bw"} (formant bandwidths), where both track matrices have four columns (corresponding to F1, F2, F3 and F4 in the \texttt{"fm"} track and F1\textsubscript{bandwidth}, F2\textsubscript{bandwidth}, F3\textsubscript{bandwidth} and F4\textsubscript{bandwidth} in the \texttt{"bw"} track) and 581 rows. To visualize the calculated formant values, R Example \ref{rexample:wrassp_plotFms} shows how R's \texttt{matplot()} function can be used to produce Figure \ref{fig:wrassp_plotFms}. -->
<!-- <<rexample:wrassp_plotFms, rexample=TRUE, eval=FALSE>>= -->
<!-- # plot the formant values -->
<!-- matplot(seq(0, numRecs.AsspDataObj(fmBwVals) - 1) -->
<!--         / rate.AsspDataObj(fmBwVals)  -->
<!--         + attr(fmBwVals, "startTime"), -->
<!--         fmBwVals$fm, -->
<!--         type = "l", -->
<!--         xlab = "time (s)", -->
<!--         ylab = "Formant frequency (Hz)") -->
<!-- # add legend -->
<!-- startFormant = 1 -->
<!-- endFormant = 4 -->
<!-- legend("topright",  -->
<!--        legend = paste0("F", startFormant:endFormant),  -->
<!--        col = startFormant:endFormant,  -->
<!--        lty = startFormant:endFormant,  -->
<!--        bg = "white") -->
<!-- @ -->
<!-- <<wrassp_plotFms, fig.cap = "Matrix plot of formant values stored in the \\texttt{fm} track of \\texttt{fmBwVals} object.", fig.width=6, fig.height=3, echo=FALSE>>= -->
<!-- # plot the formant values -->
<!-- matplot(seq(0,numRecs.AsspDataObj(fmBwVals) - 1)  -->
<!--         / rate.AsspDataObj(fmBwVals)  -->
<!--         + attr(fmBwVals, "startTime"), -->
<!--         fmBwVals$fm, -->
<!--         type = "l", -->
<!--         xlab = "time (s)", -->
<!--         ylab = "Formant frequency (Hz)") -->
<!-- # add legend -->
<!-- startFormant = 1 -->
<!-- endFormant = 4 -->
<!-- legend("topright",  -->
<!--        legend = paste0("F", startFormant:endFormant),  -->
<!--        col = startFormant:endFormant,  -->
<!--        lty = startFormant:endFormant,  -->
<!--        bg = "white") -->
<!-- @ -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \subsection{Fundamental frequency contour} -->
<!-- \label{subsec:wrassp_f0} -->
<!-- The \texttt{wrassp} package includes two fundamental frequency estimation functions called \texttt{ksvF0()} and \texttt{mhsF0()}. R Example \ref{rexample:wrassp_calcF0} shows the usage of the \texttt{ksvF0()} function, this time not utilizing the \texttt{toFile} parameter but rather to show an alternative procedure, reading the resulting \ac{ssff} file produced by it. It is worth noting that every signal processing function provided by \texttt{wrassp} creates a result file in the same directory as the audio file it was processing (except if the \texttt{outputDirectory} parameter is set otherwise). The default extension given by the \texttt{ksvF0()} is stored in \texttt{wrasspOutputInfos\$ksvF0\$ext}, which is used in R Example \ref{rexample:wrassp_calcF0} to create the newly generated file's path. -->
<!-- <<rexample:wrassp_calcF0, rexample=TRUE, results='hide'>>= -->
<!-- # calculate the fundamental frequency contour -->
<!-- ksvF0(path2wav) -->
<!-- # create path to newly generated file -->
<!-- path2f0file = file.path(path2bndl,  -->
<!--                     paste0("msajc003.",  -->
<!--                            wrasspOutputInfos$ksvF0$ext)) -->
<!-- # read file from disk -->
<!-- f0vals = read.AsspDataObj(path2f0file) -->
<!-- @ -->
<!-- By analogy with to the formant estimation example, R Example \ref{rexample:wrassp_plotF0} shows how the \texttt{plot()} function can be used to visualize this data as in Figure \ref{fig:wrassp_plotF0}. -->
<!-- <<rexample:wrassp_plotF0, rexample=TRUE, eval=FALSE>>= -->
<!-- # plot the fundamental frequency contour -->
<!-- plot(seq(0,numRecs.AsspDataObj(f0vals) - 1)  -->
<!--      / rate.AsspDataObj(f0vals) + -->
<!--        attr(f0vals, "startTime"), -->
<!--      f0vals$F0, -->
<!--      type = "l", -->
<!--      xlab = "time (s)", -->
<!--      ylab = "F0 frequency (Hz)") -->
<!-- @ -->
<!-- <<wrassp_plotF0, fig.cap = "Plot of fundamental frequency values stored in the \\texttt{F0} track of \\texttt{f0vals} object.", fig.width=6, fig.height=3, echo=FALSE>>= -->
<!-- # plot the fundamental frequency contour -->
<!-- plot(seq(0,numRecs.AsspDataObj(f0vals) - 1)  -->
<!--      / rate.AsspDataObj(f0vals) + -->
<!--        attr(f0vals, "startTime"), -->
<!--      f0vals$F0, -->
<!--      type = "l", -->
<!--      xlab = "time (s)", -->
<!--      ylab = "F0 frequency (Hz)") -->
<!-- @ -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \subsection{RMS energy contour} -->
<!-- \label{subsec:wrassp_RMS} -->
<!-- The \texttt{wrassp} function for calculating the short-term \ac{rms} amplitude of the signal is called \texttt{rmsana()}. As its usage is analogous to the above examples, here we will focus on using it to calculate the \ac{rms} values for all the audio files of the \textit{ae} \texttt{emuDB}. R Example \ref{rexample:wrassp_calcRMS} initially uses the \texttt{list.files()} function to aquire the file paths for every \texttt{.wav} file in the \textit{ae} \texttt{emuDB}. As every signal processing function accepts one or multiple file paths, these file paths can simply be passed in as the main argument to the \texttt{rmsana()} function. As all of \texttt{wrassp}'s signal processing functions place their generated files in the same directory as the audio file they process, the \texttt{rmsana()} function will automatically place every \texttt{.rms} into the correct bundle directory. -->
<!-- <<rexample:wrassp_calcRMS, rexample=TRUE, results='hide', message=FALSE>>= -->
<!-- # list all .wav files in the ae emuDB -->
<!-- paths2wavFiles = list.files(path2ae, pattern = ".*wav$",  -->
<!--                             recursive = TRUE, full.names = TRUE) -->
<!-- # calculate the RMS energy values for all .wav files -->
<!-- rmsana(paths2wavFiles) -->
<!-- # list new .rms files using  -->
<!-- # wrasspOutputInfos->rmsana->ext -->
<!-- rmsFPs = list.files(path2ae, -->
<!--                     pattern = paste0(".*",  -->
<!--                                      wrasspOutputInfos$rmsana$ext), -->
<!--                     recursive = TRUE, -->
<!--                     full.names = TRUE) -->
<!-- # read first RMS file -->
<!-- rmsvals = read.AsspDataObj(rmsFPs[1]) -->
<!-- @ -->
<!-- R Example \ref{rexample:wrassp_plotRMS} shows how the \texttt{plot()} function can be used to visualize this data as in Figure \ref{fig:wrassp_plotRMS}. -->
<!-- <<rexample:wrassp_plotRMS, rexample=TRUE, eval=FALSE>>= -->
<!-- # plot the RMS energy contour -->
<!-- plot(seq(0, numRecs.AsspDataObj(rmsvals) - 1)  -->
<!--      / rate.AsspDataObj(rmsvals)  -->
<!--      + attr(rmsvals, "startTime"), -->
<!--      rmsvals$rms, -->
<!--      type = "l", -->
<!--      xlab = "time (s)", -->
<!--      ylab = "RMS energy (dB)") -->
<!-- @ -->
<!-- <<wrassp_plotRMS, fig.cap = "Plot of RMS values stored in \\texttt{rms} track of the \\texttt{rmsvals} object.", fig.width=6, fig.height=3, echo=FALSE>>= -->
<!-- # plot the RMS energy contour -->
<!-- plot(seq(0, numRecs.AsspDataObj(rmsvals) - 1)  -->
<!--      / rate.AsspDataObj(rmsvals)  -->
<!--      + attr(rmsvals, "startTime"), -->
<!--      rmsvals$rms, -->
<!--      type = "l", -->
<!--      xlab = "time (s)", -->
<!--      ylab = "RMS energy (dB)") -->
<!-- @ -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \section{Logging \texttt{wrassp}'s function calls} -->
<!-- \label{sec:wrassp_logging} -->
<!-- As it can be extremely important to keep track of information about how certain files are created and calculated, every signal processing function provided by the \texttt{wrassp} package comes with the ability to log its function calls to a specified log file. R Example \ref{rexample:wrassp_logging} shows a call to the \texttt{ksvF0()} function where a single parameter was changed from its default value (\texttt{windowShift = 10}). The content of the created log files (shown by the call to \texttt{readLines()}) contains the function name, time stamp, parameters that were altered and processed file path information. It is worth noting that a log file can be reused for multiple function calls as the log function does not overwrite an existing file but merely appends new log information to it. -->
<!-- <<rexample:wrassp_logging, rexample=TRUE, tidy=TRUE, warning=FALSE>>= -->
<!-- # create path to log file in root dir of ae emuDB -->
<!-- path2logFile = file.path(path2ae, "wrassp.log") -->
<!-- # calculate the fundamental frequency contour -->
<!-- ksvF0(path2wav, windowShift = 10,  -->
<!--       forceToLog = T, optLogFilePath = path2logFile) -->
<!-- # display content of log file (first 8 lines) -->
<!-- readLines(path2logFile)[1:8] -->
<!-- @ -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \section{Using \texttt{wrassp} in the \ac{emu-sdms}} -->
<!-- \label{sec:wrassp_emu-sdms} -->
<!-- As shown in Section \ref{subsec:wrassp_RMS}, the \texttt{wrassp} signal processing functions can be used to calculate \ac{ssff} files and place them into the appropriate bundle directories. The only thing that has to be done to make an \texttt{emuDB} aware of these files is to add an \ac{ssff} track definition to the \texttt{emuDB} as shown in R Example \ref{rexample:wrassp_addSSFF}. Once added, this \ac{ssff} track can be referenced via the \texttt{ssffTrackName} parameter of the \texttt{get\_trackdata()} function as shown in various examples throughout this documentation. It is worth noting that this strategy is not necessarily relevant for applying the same signal processing to an entire \texttt{emuDB}, as this can be achieved using the on-the-fly \texttt{add\_ssffTrackDefinition()} method described in R Example \ref{rexample:wrassp_onTheFly}. However, it becomes necessary if certain bundles are to be processed using deviating function parameters. This can, for example, be relevant when setting the minimum and maximum frequencies that are to be considered while estimating the fundamental frequencies (e.g., the \texttt{maxF} and \texttt{minF} of \texttt{ksvfF0()}) for female versus male speakers. -->
<!-- <<rexample:wrassp_addSSFF, rexample=TRUE, results='hide'>>= -->
<!-- # load emuDB -->
<!-- ae = load_emuDB(path2ae) -->
<!-- # add SSFF track defintion  -->
<!-- # that references the .rms files -->
<!-- # calculated above  -->
<!-- # (i.e. no new files are calculated and added to the emuDB) -->
<!-- ext = wrasspOutputInfos$rmsana$ext -->
<!-- colName = wrasspOutputInfos$rmsana$tracks[1] -->
<!-- add_ssffTrackDefinition(ae, -->
<!--                         name = "rms", -->
<!--                         fileExtension = ext, -->
<!--                         columnName = colName) -->
<!-- @ -->
<!-- A further way to utilize \texttt{wrassp}'s signal processing functions as part of the \ac{emu-sdms} is via the \texttt{onTheFlyFunctionName} and \texttt{onTheFlyParams} parameters of the \texttt{add\_ssffTrackDefinition()} and \texttt{get\_trackdata()} functions. Using the \texttt{onTheFlyFunctionName} parameter in the \texttt{add\_ssffTrackDefinition()} function automatically calculates the \ac{ssff} files while also adding the \ac{ssff} track definition. Using this parameter with the \texttt{get\_trackdata()} function calls the given \texttt{wrassp} function with the \texttt{toFile} parameter set to \texttt{FALSE} and extracts the matching segments and places them in the resulting \texttt{trackdata} or \texttt{emuRtrackdata} object. In many cases, this avoids the necessity of having \ac{ssff} track definitions in the \texttt{emuDB}. In both functions, the optional \texttt{onTheFlyParams} parameter can be used to specify the parameters that are passed into the signal processing function. R Example \ref{rexample:wrassp_onTheFly} shows how R's \texttt{formals()} function can be used to get all the parameters of \texttt{wrassp}'s short-term positive and negative \ac{zcr} analysis function \texttt{zrcana()}. It then changes the default window size parameter to a new value and passes the parameters object into the \texttt{add\_ssffTrackDefinition()} and \texttt{get\_trackdata()} functions. -->
<!-- <<rexample:wrassp_onTheFly, rexample=TRUE>>= -->
<!-- # get all parameters of zcrana -->
<!-- zcranaParams = formals("zcrana") -->
<!-- # show names of parameters -->
<!-- names(zcranaParams) -->
<!-- # change window size from the default  -->
<!-- # value of 25 ms to 50 ms -->
<!-- zcranaParams$windowSize = 50 -->
<!-- # to have a segment list to work with -->
<!-- # query all Phonetic 'n' segments -->
<!-- sl = query(ae, "Phonetic == n") -->
<!-- # get trackdata calculating ZCR values on-the-fly -->
<!-- # using the above parameters. Note that no files -->
<!-- # are generated. -->
<!-- td = get_trackdata(ae, sl,  -->
<!--                    onTheFlyFunctionName = "zcrana", -->
<!--                    onTheFlyParams = zcranaParams, -->
<!--                    verbose = FALSE) -->
<!-- # add SSFF track definition. Note that  -->
<!-- # this time files are generated. -->
<!-- add_ssffTrackDefinition(ae, -->
<!--                         name = "zcr", -->
<!--                         onTheFlyFunctionName = "zcrana", -->
<!--                         onTheFlyParams = zcranaParams,  -->
<!--                         verbose = FALSE) -->
<!-- @ -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \section{Storing data in the SSFF file format} -->
<!-- \label{sec:wrassp_genSSFF} -->
<!-- One of the benefits gained by having the \texttt{AsspDataObj} in-memory object is that these objects can be constructed from scratch in R, as they are basically simple \texttt{list} objects. This means, for example, that any set of n-dimensional samples over time can be placed in a \texttt{AsspDataObj} and then stored as an \ac{ssff} file using the \texttt{write.AsspDataObj()} function. To show how this can be done, R Example \ref{rexample:wrassp_genSin} creates an arbitrary data sample in the form of a single cycle sine wave between $0$ and $2*pi$ that is made up of 16000 samples and displays it in Figure \ref{fig:wrassp_genSin}. -->
<!-- <<rexample:wrassp_genSin, rexample=TRUE, eval=FALSE>>= -->
<!-- x = seq(0, 2 * pi, length.out = 16000) -->
<!-- sineWave = sin(x) -->
<!-- plot(x, sineWave, type = 'l',  -->
<!--      xlab = "x from 0 to 2*pi", -->
<!--      ylab = "") -->
<!-- @ -->
<!-- <<wrassp_genSin, fig.cap = "A single cycle sine wave consisting of 16000 samples.", fig.width=6, fig.height=3, echo=FALSE>>= -->
<!-- x = seq(0, 2 * pi, length.out = 16000) -->
<!-- sineWave = sin(x) -->
<!-- plot(x, sineWave, type = 'l',  -->
<!--      xlab = "x from 0 to 2*pi", -->
<!--      ylab = "") -->
<!-- @ -->
<!-- Assuming a sample rate of 16 kHz \texttt{sineWave} would result in a sine wave with a frequency of 1 Hz and a duration of one second. R Example \ref{rexample:wrassp_genAdo} shows how a \texttt{AsspDataObj} can be created from scratch and the data in \texttt{sineWave} placed into one of its tracks. It then goes on to write the \texttt{AsspDataObj} object to an \ac{ssff} file. -->
<!-- <<rexample:wrassp_genAdo, rexample=TRUE>>= -->
<!-- # create empty list object -->
<!-- ado = list() -->
<!-- # add sample rate attribute -->
<!-- attr(ado, "sampleRate") = 16000 -->
<!-- # add start time attribute -->
<!-- attr(ado, "startTime") = 0 -->
<!-- # add start record attribute   -->
<!-- attr(ado, "startRecord") = as.integer(1) -->
<!-- # add end record attribute   -->
<!-- attr(ado, "endRecord") = as.integer(length(sineWave)) -->
<!-- # set class of ado -->
<!-- class(ado) = "AsspDataObj" -->
<!-- # show available file formats -->
<!-- AsspFileFormats -->
<!-- # set file format to SSFF -->
<!-- # NOTE: assignment of "SSFF" also possible -->
<!-- AsspFileFormat(ado) = as.integer(20)  -->
<!-- # set data format (1 == 'ascii' and 2 == 'binary') -->
<!-- AsspDataFormat(ado) = as.integer(2) -->
<!-- # set track format specifiers -->
<!-- # (available track formats for numbers   -->
<!-- # that match their C equivalent are: -->
<!-- # "UINT8"; "INT8"; "UINT16"; "INT16"; -->
<!-- # "UINT24"; "INT24"; "UINT32"; "INT32";  -->
<!-- # "UINT64"; "INT64"; "REAL32"; "REAL64"); -->
<!-- attr(ado, "trackFormats") = c("REAL32") -->
<!-- # add track -->
<!-- ado = addTrack(ado, "sine", sineWave, "REAL32") -->
<!-- # write AsspDataObj object to file -->
<!-- write.AsspDataObj(dobj = ado,  -->
<!--                   file = file.path(tempdir(), "example.sine")) -->
<!-- @ -->
<!-- Although somewhat of a generic example, R Example \ref{rexample:wrassp_genAdo} shows how to generate an \texttt{AsspDataObj} from scratch. This approach can, for example, be used to read in signal data produced by other software or signal data acquisition devices. Hence, this approach can be used to import many forms of data into the \ac{emu-sdms}. Appendix \ref{sec:app_chap-wrassp_praatsSigProc} shows an example of how this approach can be used to take advantage of Praat's signal processing capabilities and integrate its output into the \ac{emu-sdms}. -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- \section{Conclusion} -->
<!-- The \texttt{wrassp} packages enriches the R package landscape by providing functionality for handling speech signal files in most common audio formats and for performing signal analyses common in the phonetic and speech sciences. The \ac{emu-sdms} utilizes the functionality that the \texttt{wrassp} package provides by allowing the user to calculate signals that match the segments of a segment list. This can either be done in real time or by extracting the signals from files. Hence, the \texttt{wrassp} package is an integral part of the \ac{emu-sdms} but can also be used as a standalone package if so desired. -->
<!-- <<echo=FALSE, results='hide', message=FALSE>>= -->
<!-- # clean up emuR_demoData -->
<!-- unlink(file.path(tempdir(), "emuR_demoData"), recursive = TRUE) -->
<!-- @ -->
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Some examples of this chapter are adapted version of examples given in the <code>wrassp_intro</code> vignette of the <code>wrassp</code> package.<a href="#fnref1" class="footnote-back">â†©</a></p></li>
</ol>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

</body>

</html>
